# トーナメント表描画ロジック仕様書

## 概要

可変チーム数に対応したトーナメントブラケットの構造計算・描画ロジックを定義する。

## 設計思想: 8チームブロック単位

### コアコンセプト

**8チームを1ブロックの基本単位**として設計する。

- 各ブロックには1〜8チームが存在
- ブロック内の描画パターンは8通りのみ
- 大規模トーナメントはブロックの組み合わせで実現

```
┌─────────────────────────────────────────────────────┐
│  トーナメント全体 = ブロック × N + ブロック間接続    │
│                                                     │
│  ブロック: 1-8チームの小トーナメント（8パターン）    │
│  接続: ブロック勝者同士の準決勝・決勝               │
└─────────────────────────────────────────────────────┘
```

### ブロック数の決定

| 総チーム数 | ブロック数 | 各ブロックのチーム数例        |
|-----------|-----------|------------------------------|
| 1-8       | 1         | そのまま                      |
| 9-16      | 2         | 4+5, 5+5, 8+8 など           |
| 17-32     | 4         | 4+4+4+5, 8+8+8+8 など        |
| 33-64     | 8         | 各ブロック4-8チーム          |

---

## ブロック内パターン（1-8チーム）

### パターン一覧

| パターン | チーム数 | 山配分 | 1回戦 | 準決勝 | 決勝 | 総試合数 | シード数 |
|---------|---------|-------|------|-------|-----|---------|---------|
| P1      | 1       | -     | -    | -     | -   | -       | **未対応** |
| P2      | 2       | 1+1   | 0    | 0     | 1   | 1       | 0       |
| P3      | 3       | 1+2   | 1    | 0     | 1   | 2       | 1       |
| P4      | 4       | 2+2   | 0    | 2     | 1   | 3       | 0       |
| P5      | 5       | 2+3   | 1    | 2     | 1   | 4       | 1       |
| P6      | 6       | 3+3   | 2    | 2     | 1   | 5       | 2       |
| P7      | 7       | 3+4   | 3    | 2     | 1   | 6       | 1       |
| P8      | 8       | 4+4   | 4    | 2     | 1   | 7       | 0       |

> **注意**: P1（1チームのみ）は実用上不要のため未対応。試合数0を渡すとエラーになる。

### 各パターンの構造図

#### P1: 1チーム（未対応）

> 1チームのみのケースは実用上不要のため未対応。

#### P2: 2チーム（決勝のみ）
```
[チーム1] ─┐
           ├─→ 勝者
[チーム2] ─┘
```

#### P3: 3チーム（1+2配分）
```
[チーム1] シード ──┐
                   ├─→ 勝者
[チーム2] ─┐       │
           ├───────┘
[チーム3] ─┘
```

> チーム1はシード（不戦勝）として1回戦カラムに表示される。

#### P4: 4チーム（2+2配分、準決勝から）
```
[チーム1] ─┐
           ├─ SF1 ─┐
[チーム2] ─┘       │
                   ├─→ 勝者
[チーム3] ─┐       │
           ├─ SF2 ─┘
[チーム4] ─┘
```

#### P5: 5チーム（2+3配分）
```
[チーム1] シード ─ SF1 ─┐
                        │
                        ├─→ 勝者
[チーム2] ─────┐        │
               ├─ SF2 ──┘
[チーム3] ─┐   │
           ├───┘
[チーム4] ─┘
```

> チーム1はシード（不戦勝）として1回戦カラムに表示される。

#### P6: 6チーム（3+3配分）
```
[チーム1] シード ──┐
                   ├─ SF1 ─┐
[チーム2] ─┐       │       │
           ├───────┘       │
[チーム3] ─┘               ├─→ 勝者
                           │
[チーム4] ─┐               │
           ├───────┐       │
[チーム5] ─┘       ├─ SF2 ─┘
                   │
[チーム6] シード ──┘
```

> チーム1とチーム6はシード（不戦勝）として1回戦カラムに表示される。

#### P7: 7チーム（3+4配分）
```
[チーム1] シード ──┐
                   ├─ SF1 ─┐
[チーム2] ─┐       │       │
           ├───────┘       │
[チーム3] ─┘               ├─→ 勝者
                           │
[チーム4] ─┐               │
           ├───┐           │
[チーム5] ─┘   ├─ SF2 ─────┘
               │
[チーム6] ─┐   │
           ├───┘
[チーム7] ─┘
```

> チーム1はシード（不戦勝）として1回戦カラムに表示される。

#### P8: 8チーム（4+4配分、現行システム）
```
[チーム1] ─┐
           ├─ QF1 ─┐
[チーム2] ─┘       │
                   ├─ SF1 ─┐
[チーム3] ─┐       │       │
           ├─ QF2 ─┘       │
[チーム4] ─┘               ├─→ 勝者
                           │
[チーム5] ─┐               │
           ├─ QF3 ─┐       │
[チーム6] ─┘       │       │
                   ├─ SF2 ─┘
[チーム7] ─┐       │
           ├─ QF4 ─┘
[チーム8] ─┘
```

---

## ブロックの組み合わせ（9チーム以上）

### 設計方針

- **描画に特化**: 勝敗ロジックはトーナメント表に持たせない
- **ブロックは最大3ステップ**: 1回戦→準決勝→決勝相当
- **再帰的構造**: ブロックの勝者を集めて新しいブロックを作成

### レイアウト方針

- **水平方向は最大3ステップ**（1回戦→準決勝→決勝相当）
- **ブロックは縦方向（下）に追加していく**
- 決勝ブロックも下に配置（右に伸ばさない）

### 2ブロック構成（9-16チーム）

```
┌─────────────────────────────────────────┐
│                Block A                  │
│              (4-8チーム)                 │
│         [最大3ステップで描画]            │
│                    → 勝者A              │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│                Block B                  │
│              (4-8チーム)                 │
│         [最大3ステップで描画]            │
│                    → 勝者B              │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│             決勝ブロック                 │
│    勝者A vs 勝者B（P2パターンで描画）     │
└─────────────────────────────────────────┘
```

### 4ブロック構成（17-32チーム）

```
┌─────────────────────────────────────────┐
│                Block A → 勝者A          │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│                Block B → 勝者B          │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│                Block C → 勝者C          │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│                Block D → 勝者D          │
└─────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────┐
│             決勝ブロック                 │
│  勝者A,B,C,D（P4パターンで描画）         │
└─────────────────────────────────────────┘
```

### 8ブロック構成（33-64チーム）

- Block A〜H を縦に配置
- 最後に決勝ブロック（P8パターン）を下に追加

### チーム配分例

| 総チーム数 | ブロック数 | 配分例 | 決勝ブロック |
|-----------|-----------|--------|-------------|
| 9         | 2         | 4+5    | P2          |
| 12        | 2         | 6+6    | P2          |
| 16        | 2         | 8+8    | P2          |
| 17        | 4         | 4+4+4+5 | P4         |
| 24        | 4         | 6+6+6+6 | P4         |
| 32        | 4         | 8+8+8+8 | P4         |
| 33        | 8         | 4×7+5  | P8          |
| 64        | 8         | 8×8    | P8          |

---

## 描画仕様

### レイアウト

- 左から右へ進行（1回戦 → 決勝）
- 各ラウンドは1カラム
- カード間の接続線はSVGで描画
- 後続ラウンドのカードは、前ラウンドの対応するカード群の**中央**に配置する

