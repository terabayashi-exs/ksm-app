# ã‚¹ãƒãƒ³ã‚µãƒ¼ãƒãƒŠãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“‹ æ¦‚è¦

éƒ¨é–€è©³ç´°ç”»é¢ï¼ˆå…¬é–‹ãƒšãƒ¼ã‚¸ï¼‰ã«åºƒå‘ŠãƒãƒŠãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚
ç®¡ç†è€…ãŒå¤§ä¼šã”ã¨ã«ã‚¹ãƒãƒ³ã‚µãƒ¼ãƒãƒŠãƒ¼ã‚’ç™»éŒ²ãƒ»ç®¡ç†ã—ã€ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–²è¦§ã™ã‚‹éƒ¨é–€è©³ç´°ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### 1. ãƒãƒŠãƒ¼ç™»éŒ²ãƒ»ç®¡ç†
- **ãƒãƒŠãƒ¼ä½œæˆ**: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒªãƒ³ã‚¯URLè¨­å®šã€è¡¨ç¤ºè¨­å®š
- **ãƒãƒŠãƒ¼ç·¨é›†**: æ—¢å­˜ãƒãƒŠãƒ¼ã®æƒ…å ±æ›´æ–°ã€ç”»åƒå·®ã—æ›¿ãˆ
- **ãƒãƒŠãƒ¼å‰Šé™¤**: ãƒãƒŠãƒ¼å‰Šé™¤æ™‚ã®Blobç”»åƒè‡ªå‹•å‰Šé™¤
- **ä¸€è¦§è¡¨ç¤º**: å¤§ä¼šåˆ¥ã®ãƒãƒŠãƒ¼ä¸€è¦§ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### 2. è¡¨ç¤ºä½ç½®åˆ¶å¾¡
3ã¤ã®è¡¨ç¤ºä½ç½®ã‹ã‚‰é¸æŠå¯èƒ½ï¼š
- **ã‚¿ãƒ–ä¸Šéƒ¨ï¼ˆtopï¼‰**: å„ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æœ€ä¸Šéƒ¨ã«è¡¨ç¤º
- **ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆsidebarï¼‰**: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å³å´ã«è¡¨ç¤ºï¼ˆPCè¡¨ç¤ºã®ã¿ï¼‰
- **ã‚¿ãƒ–ä¸‹éƒ¨ï¼ˆbottomï¼‰**: å„ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æœ€ä¸‹éƒ¨ã«è¡¨ç¤º

æ¨å¥¨ç”»åƒã‚µã‚¤ã‚º:
- ã‚¿ãƒ–ä¸Šéƒ¨: 728 Ã— 90pxï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰
- ã‚µã‚¤ãƒ‰ãƒãƒ¼: 200 Ã— 200pxï¼ˆã‚¹ã‚¯ã‚¨ã‚¢ï¼‰
- ã‚¿ãƒ–ä¸‹éƒ¨: 728 Ã— 90pxï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰

### 3. ã‚¿ãƒ–åˆ¥è¡¨ç¤ºåˆ¶å¾¡
è¡¨ç¤ºå¯¾è±¡ã‚¿ãƒ–ã‚’ç´°ã‹ãæŒ‡å®šå¯èƒ½ï¼š
- **å…¨ã‚¿ãƒ–ï¼ˆallï¼‰**: ã™ã¹ã¦ã®ã‚¿ãƒ–ã§è¡¨ç¤º
- **æ¦‚è¦ï¼ˆoverviewï¼‰**: éƒ¨é–€æ¦‚è¦ã‚¿ãƒ–ã®ã¿
- **æ—¥ç¨‹ãƒ»çµæœï¼ˆscheduleï¼‰**: æ—¥ç¨‹ãƒ»çµæœã‚¿ãƒ–ã®ã¿
- **äºˆé¸çµæœï¼ˆpreliminaryï¼‰**: äºˆé¸çµæœã‚¿ãƒ–ã®ã¿
- **æ±ºå‹çµæœï¼ˆfinalï¼‰**: æ±ºå‹çµæœã‚¿ãƒ–ã®ã¿
- **é †ä½è¡¨ï¼ˆstandingsï¼‰**: é †ä½è¡¨ã‚¿ãƒ–ã®ã¿
- **å‚åŠ ãƒãƒ¼ãƒ ï¼ˆteamsï¼‰**: å‚åŠ ãƒãƒ¼ãƒ ã‚¿ãƒ–ã®ã¿

### 4. è¡¨ç¤ºæœŸé–“è¨­å®š
- **é–‹å§‹æ—¥**: ãƒãƒŠãƒ¼è¡¨ç¤ºé–‹å§‹æ—¥ï¼ˆçœç•¥å¯ï¼‰
- **çµ‚äº†æ—¥**: ãƒãƒŠãƒ¼è¡¨ç¤ºçµ‚äº†æ—¥ï¼ˆçœç•¥å¯ï¼‰
- **æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ**: `is_active`ãƒ•ãƒ©ã‚°ã§å³åº§ã«ON/OFFå¯èƒ½

### 5. ã‚¯ãƒªãƒƒã‚¯æ•°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- ãƒãƒŠãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚ã«APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã‚«ã‚¦ãƒ³ãƒˆ
- `/api/public/sponsor-banners/[id]/click` - ã‚¯ãƒªãƒƒã‚¯æ•°ã‚«ã‚¦ãƒ³ãƒˆAPI
- ç®¡ç†ç”»é¢ã§ã‚¯ãƒªãƒƒã‚¯æ•°ç¢ºèªå¯èƒ½

### 6. ç”»åƒç®¡ç†ï¼ˆVercel Blob Storageï¼‰
- **è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ãƒãƒŠãƒ¼ä½œæˆãƒ»æ›´æ–°æ™‚ã«è‡ªå‹•ã§Blobã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **è‡ªå‹•å‰Šé™¤**: ãƒãƒŠãƒ¼å‰Šé™¤ãƒ»æ›´æ–°ãƒ»å¤§ä¼šå‰Šé™¤æ™‚ã«å¤ã„ç”»åƒã‚’è‡ªå‹•å‰Šé™¤
- **ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ç®¡ç†**: ãƒ•ã‚¡ã‚¤ãƒ«åã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’è¨˜éŒ²

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### t_sponsor_banners ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE IF NOT EXISTS t_sponsor_banners (
  banner_id INTEGER PRIMARY KEY AUTOINCREMENT,
  tournament_id INTEGER NOT NULL,
  banner_name TEXT NOT NULL,
  banner_url TEXT,
  image_blob_url TEXT NOT NULL,
  image_filename TEXT,
  file_size INTEGER,
  display_position TEXT NOT NULL CHECK(display_position IN ('top', 'bottom', 'sidebar')),
  target_tab TEXT NOT NULL DEFAULT 'all' CHECK(target_tab IN ('all', 'overview', 'schedule', 'preliminary', 'final', 'standings', 'teams')),
  display_order INTEGER DEFAULT 0,
  is_active INTEGER DEFAULT 1 CHECK(is_active IN (0, 1)),
  start_date DATE,
  end_date DATE,
  click_count INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT (datetime('now', '+9 hours')),
  updated_at DATETIME DEFAULT (datetime('now', '+9 hours')),
  FOREIGN KEY (tournament_id) REFERENCES t_tournaments(tournament_id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_sponsor_banners_display
ON t_sponsor_banners(tournament_id, target_tab, display_position, display_order);

CREATE INDEX IF NOT EXISTS idx_sponsor_banners_active
ON t_sponsor_banners(tournament_id, is_active);

CREATE INDEX IF NOT EXISTS idx_sponsor_banners_dates
ON t_sponsor_banners(start_date, end_date);
```

### ã‚«ãƒ©ãƒ èª¬æ˜
- `banner_id`: ãƒãƒŠãƒ¼IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰
- `tournament_id`: å¤§ä¼šIDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ã€CASCADEå‰Šé™¤ï¼‰
- `banner_name`: ãƒãƒŠãƒ¼åç§°ï¼ˆç®¡ç†ç”¨ï¼‰
- `banner_url`: ãƒªãƒ³ã‚¯å…ˆURLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `image_blob_url`: Blob Storageç”»åƒURL
- `image_filename`: å…ƒãƒ•ã‚¡ã‚¤ãƒ«å
- `file_size`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
- `display_position`: è¡¨ç¤ºä½ç½®ï¼ˆtop/bottom/sidebarï¼‰
- `target_tab`: è¡¨ç¤ºå¯¾è±¡ã‚¿ãƒ–
- `display_order`: è¡¨ç¤ºé †åºï¼ˆæ˜‡é †ï¼‰
- `is_active`: æœ‰åŠ¹/ç„¡åŠ¹ãƒ•ãƒ©ã‚°
- `start_date`: è¡¨ç¤ºé–‹å§‹æ—¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `end_date`: è¡¨ç¤ºçµ‚äº†æ—¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `click_count`: ã‚¯ãƒªãƒƒã‚¯æ•°
- `created_at`: ä½œæˆæ—¥æ™‚ï¼ˆJSTï¼‰
- `updated_at`: æ›´æ–°æ—¥æ™‚ï¼ˆJSTï¼‰

## ğŸ”Œ APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ç®¡ç†è€…ç”¨API

#### ãƒãƒŠãƒ¼ä¸€è¦§å–å¾—
```
GET /api/admin/sponsor-banners?tournament_id={id}
```

#### ãƒãƒŠãƒ¼ä½œæˆ
```
POST /api/admin/sponsor-banners
Content-Type: application/json

{
  "tournament_id": 1,
  "banner_name": "ã‚¹ãƒãƒ³ã‚µãƒ¼A",
  "banner_url": "https://example.com",
  "image_blob_url": "https://blob.vercel-storage.com/...",
  "display_position": "top",
  "target_tab": "all",
  "display_order": 0,
  "is_active": 1
}
```

#### ãƒãƒŠãƒ¼æ›´æ–°
```
PATCH /api/admin/sponsor-banners/[id]
Content-Type: application/json

{
  "banner_name": "ã‚¹ãƒãƒ³ã‚µãƒ¼Aï¼ˆæ›´æ–°ï¼‰",
  "is_active": 0
}
```

#### ãƒãƒŠãƒ¼å‰Šé™¤
```
DELETE /api/admin/sponsor-banners/[id]
```

#### ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```
POST /api/admin/sponsor-banners/upload
Content-Type: multipart/form-data

file: [ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«]
tournament_id: 1
```

### å…¬é–‹API

#### ãƒãƒŠãƒ¼å–å¾—
```
GET /api/public/sponsor-banners?tournament_id={id}&position={position}&tab={tab}
```

#### ã‚¯ãƒªãƒƒã‚¯æ•°ã‚«ã‚¦ãƒ³ãƒˆ
```
POST /api/public/sponsor-banners/[id]/click
```

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

#### ç®¡ç†ç”»é¢
- **SponsorBannerList.tsx**: ãƒãƒŠãƒ¼ä¸€è¦§è¡¨ç¤º
- **SponsorBannerForm.tsx**: ãƒãƒŠãƒ¼ä½œæˆãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
- ãƒšãƒ¼ã‚¸: `/admin/tournaments/[id]/sponsor-banners`

#### å…¬é–‹ç”»é¢
- **SponsorBanners.tsx**: ãƒãƒŠãƒ¼è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **TabContentWithSidebar.tsx**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ä»˜ããƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- **useSidebarBanners.ts**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒŠãƒ¼æœ‰ç„¡åˆ¤å®šãƒ•ãƒƒã‚¯

### å‹•çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ¶å¾¡

ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒŠãƒ¼ã®æœ‰ç„¡ã«å¿œã˜ã¦ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å‹•çš„ã«å¤‰æ›´ï¼š

```typescript
// ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒŠãƒ¼ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
<div className="grid grid-cols-1 lg:grid-cols-[1fr_200px] gap-6">
  {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆ70%ï¼‰ */}
  <div className="min-w-0">{children}</div>

  {/* ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆ200pxå›ºå®šå¹…ï¼‰*/}
  <aside className="hidden lg:block space-y-4">
    <SponsorBanners position="sidebar" />
  </aside>
</div>

// ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒŠãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆ
<div>
  {children} {/* å…¨å¹…è¡¨ç¤º */}
</div>
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
- **PCè¡¨ç¤º**: ã™ã¹ã¦ã®è¡¨ç¤ºä½ç½®ï¼ˆtop, sidebar, bottomï¼‰ãŒè¡¨ç¤º
- **ã‚¹ãƒãƒ›/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¯éè¡¨ç¤ºã€top/bottomã®ã¿è¡¨ç¤º
- **æ³¨æ„æ›¸ã**: ç®¡ç†ç”»é¢ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼é¸æŠæ™‚ã«ã€ŒPCè¡¨ç¤ºã®ã¿ã€ã®æ³¨æ„æ›¸ãã‚’è¡¨ç¤º

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ç®¡ç†è€…APIã¯èªè¨¼å¿…é ˆï¼ˆNextAuth.jsã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰
- å…¬é–‹APIã¯èªè¨¼ä¸è¦ï¼ˆä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ç”»åƒã‚µã‚¤ã‚ºåˆ¶é™: æœ€å¤§5MB
- ç”»åƒå½¢å¼åˆ¶é™: JPEG, PNG, GIF, WebP
- URLå½¢å¼æ¤œè¨¼: ãƒªãƒ³ã‚¯URLã®å½¢å¼ãƒã‚§ãƒƒã‚¯

## ğŸ“Š å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…å®Œäº†
- ãƒãƒŠãƒ¼ç®¡ç†ç”»é¢ï¼ˆä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»è‡ªå‹•å‰Šé™¤
- å…¬é–‹ãƒšãƒ¼ã‚¸è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯æ•°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- å‹•çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ¶å¾¡
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
- è¡¨ç¤ºæœŸé–“ãƒ»æœ‰åŠ¹ç„¡åŠ¹åˆ¶å¾¡
- ã‚¿ãƒ–åˆ¥ãƒ»ä½ç½®åˆ¥è¡¨ç¤ºåˆ¶å¾¡

### ğŸ“ˆ é‹ç”¨å®Ÿç¸¾
- **å®Ÿè£…æ—¥**: 2026å¹´1æœˆ13æ—¥
- **ãƒ†ãƒ¼ãƒ–ãƒ«æ•°**: 1ï¼ˆt_sponsor_bannersï¼‰
- **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: 6ä»¶
- **ç”»é¢æ•°**: 3ç”»é¢ï¼ˆä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ï¼‰

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- `lib/db.ts` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

### API
- `app/api/admin/sponsor-banners/route.ts` - ä¸€è¦§ãƒ»ä½œæˆ
- `app/api/admin/sponsor-banners/[id]/route.ts` - æ›´æ–°ãƒ»å‰Šé™¤
- `app/api/admin/sponsor-banners/upload/route.ts` - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `app/api/public/sponsor-banners/route.ts` - å…¬é–‹ãƒãƒŠãƒ¼å–å¾—
- `app/api/public/sponsor-banners/[id]/click/route.ts` - ã‚¯ãƒªãƒƒã‚¯æ•°ã‚«ã‚¦ãƒ³ãƒˆ

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `components/admin/SponsorBannerForm.tsx` - ãƒãƒŠãƒ¼ãƒ•ã‚©ãƒ¼ãƒ 
- `components/public/SponsorBanners.tsx` - ãƒãƒŠãƒ¼è¡¨ç¤º
- `components/public/TabContentWithSidebar.tsx` - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `lib/sponsor-banner-specs.ts` - ãƒãƒŠãƒ¼ä»•æ§˜å®šç¾©
- `lib/blob-helpers.ts` - Blobå‰Šé™¤ãƒ˜ãƒ«ãƒ‘ãƒ¼
- `hooks/useSidebarBanners.ts` - ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒŠãƒ¼æ¤œå‡º

### ãƒšãƒ¼ã‚¸
- `app/admin/tournaments/[id]/sponsor-banners/page.tsx` - ãƒãƒŠãƒ¼ä¸€è¦§
- `app/admin/tournaments/[id]/sponsor-banners/create/page.tsx` - ãƒãƒŠãƒ¼ä½œæˆ
- `app/admin/tournaments/[id]/sponsor-banners/[bannerId]/edit/page.tsx` - ãƒãƒŠãƒ¼ç·¨é›†
- `app/public/tournaments/[id]/page.tsx` - å…¬é–‹ãƒšãƒ¼ã‚¸ï¼ˆãƒãƒŠãƒ¼è¡¨ç¤ºï¼‰

## ğŸ’¡ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

- [ ] A/Bãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- [ ] ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ•°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- [ ] ãƒãƒŠãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- [ ] ã‚¯ãƒªãƒƒã‚¯ç‡åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] å‹•ç”»ãƒãƒŠãƒ¼å¯¾å¿œ
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒŠãƒ¼å¯¾å¿œ

---

**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ13æ—¥
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ¬ç•ªé‹ç”¨å¯èƒ½
