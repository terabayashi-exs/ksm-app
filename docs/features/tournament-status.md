# 大会ステータス管理システム

[← 実装済み機能一覧に戻る](./implemented-features.md)

## 🎯 大会ステータス管理システム

### 基本概念

大会のライフサイクルを適切に管理するため、従来の単純なステータス（planning/ongoing/completed）から、日付ベースの動的ステータス判定システムに変更しました。

### ステータス分類

| ステータス | 英語表記 | 条件 | 説明 |
|------------|----------|------|------|
| **募集前** | `planning` | 現在 < 募集開始日 | まだ募集期間に達していない状態 |
| **募集中** | `recruiting` | 募集開始日 ≤ 現在 ≤ 募集終了日 | チーム募集を受付中の状態 |
| **開催前** | `before_event` | 募集終了日 < 現在 < 大会開始日 | 募集は終了したが大会開催前の状態 |
| **開催中** | `ongoing` | 大会開始日 ≤ 現在 ≤ 大会終了日 | 大会期間中の状態 |
| **終了** | `completed` | 現在 > 大会終了日 または DB状態が完了 | 大会が終了した状態 |

### 実装仕様

#### **動的ステータス判定（lib/tournament-status.ts）**
- 現在日時と各日付フィールドを比較してリアルタイム判定
- データベースの以下フィールドを活用：
  - `recruitment_start_date`: 募集開始日
  - `recruitment_end_date`: 募集終了日
  - `tournament_dates`: 大会開催日程（JSON形式）
  - `status`: DB上の手動設定ステータス

#### **主要関数**
```typescript
// ステータス動的判定
calculateTournamentStatus(tournament): TournamentStatus

// 表示用ラベル取得
getStatusLabel(status): string

// 表示用カラークラス取得
getStatusColor(status): string

// 開催期間フォーマット
formatTournamentPeriod(tournamentDatesJson): string
```

### ステータス更新タイミング

#### **🔄 自動更新（推奨）**
- **募集前 → 募集中**: 募集開始日 00:00 に自動更新
- **募集中 → 開催前**: 募集終了日 23:59 翌日に自動更新
- **開催前 → 開催中**: 大会開始日 00:00 に自動更新
- **開催中 → 終了**: 大会最終日 23:59 翌日に自動更新

#### **⚙️ 手動更新が必要な場面**
1. **早期終了**: 予定より早く大会を終了させる場合
2. **全試合確定**: 管理者が明示的に大会完了を宣言する場合
3. **例外対応**: 日程変更や特殊事情による状態調整

### 運用上の利点

1. **自動化**: 日付設定のみで大会ライフサイクルを自動管理
2. **リアルタイム**: ページアクセス時に常に最新ステータスを表示
3. **運用負荷軽減**: 手動でのステータス変更作業が不要
4. **一貫性**: 全ての画面で統一されたステータス表示
5. **検索精度**: より詳細な条件での大会検索が可能

### 技術的考慮事項

- ステータス判定は毎回計算されるため、大量データでは性能に注意
- タイムゾーンは日本時間（JST）を基準とする
- 日付比較は日単位で行い、時刻は考慮しない
- データベースの`status`フィールドは管理者による強制設定用として残存

