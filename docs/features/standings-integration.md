# 順位表統合システム

[← 実装済み機能一覧に戻る](./implemented-features.md)

## 📊 順位表統合システム

### 基本概念

予選リーグと決勝トーナメントの順位情報を一元表示し、大会全体の進行状況と最終結果を包括的に管理するシステムです。

### 実装仕様

#### **1. 統合表示機能**
- **予選ブロック**: 詳細成績（勝点、試合数、勝敗、得失点）
- **決勝トーナメント**: 順位とステータス（優勝、準優勝、3位、4位、準々決勝敗退）
- **リアルタイム更新**: 試合確定時の即座な順位反映

#### **2. 決勝トーナメント順位計算**
```typescript
// lib/standings-calculator.ts - calculateFinalTournamentStandings()
const rankings = [
  // 1位・2位（決勝戦結果）
  // 3位・4位（3位決定戦結果 or 準決勝敗者同着）
  // 5位（準々決勝敗者全員）
];
```

#### **3. 順位決定ルール**
- **通常ケース**: 1位、2位、3位、4位、5位、5位、5位、5位
- **3位決定戦なし**: 1位、2位、3位、3位、5位、5位、5位、5位

#### **4. API統合**
```typescript
// /api/tournaments/[id]/standings
{
  success: true,
  data: [
    { phase: 'preliminary', teams: [...] },  // 予選ブロック
    { phase: 'final', teams: [...] }         // 決勝トーナメント
  ],
  totalMatches: 32  // 確定済み試合数（正確な計算）
}
```

### UI実装

#### **タブ構成**
大会詳細画面: 概要 → 日程・結果 → トーナメント表 → 戦績表 → **順位表** → 参加チーム

#### **表示項目**
- **予選**: 順位、チーム名、勝点、試合数、勝敗、得失点
- **決勝**: 順位、チーム名、備考（優勝、準優勝、3位、4位、準々決勝敗退）

#### **総試合数の正確な計算**
```typescript
// 従来: チーム毎matches_playedの合計（1試合が2回カウント）
// 修正: t_matches_finalから直接確定試合数を取得
SELECT COUNT(*) FROM t_matches_final WHERE tournament_id = ?
```

